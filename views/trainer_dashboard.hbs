<!DOCTYPE html>
<html lang="uk">

<head>
  <meta charset="UTF-8">
  <title>–ö–∞–±—ñ–Ω–µ—Ç –¢—Ä–µ–Ω–µ—Ä–∞</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
</head>

<body class="bg-light d-flex flex-column min-vh-100">
  {{> menu}}
  <div class="container pb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>üìÖ –†–æ–±–æ—á–∏–π –≥—Ä–∞—Ñ—ñ–∫</h2>
      <button type="button" class="btn btn-success btn-lg shadow" data-bs-toggle="modal" data-bs-target="#addModal">
        + –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å
      </button>
    </div>
    <div id='calendar'></div>
  </div>
  <div class="modal fade" id="addModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">–ù–æ–≤–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form action="/trainer/add-booking" method="POST">
            <div class="mb-3">
              <label class="form-label fw-bold">–ö–ª—ñ—î–Ω—Ç</label>
              <select name="client_id" class="form-select" required>
                <option value="" selected disabled>–û–±–µ—Ä—ñ—Ç—å –∫–ª—ñ—î–Ω—Ç–∞...</option>
                {{#each clientsList}}
                <option value="{{this.id}}">{{this.full_name}}</option>
                {{/each}}
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">–ü–æ—Å–ª—É–≥–∞</label>
              <input type="text" class="form-control" value="{{fixedService.title}}" disabled readonly
                style="background-color: #e9ecef;">
              <input type="hidden" name="price_id" value="{{fixedService.id}}">
            </div>
            <div class="row mb-3">
              <div class="col-6">
                <label class="form-label fw-bold">–î–∞—Ç–∞</label>
                <input type="date" name="start_date" class="form-control" required>
              </div>
              <div class="col-6">
                <label class="form-label fw-bold">–ß–∞—Å</label>
                <select name="start_time" class="form-select" required>
                  <option value="" selected disabled>–ì–æ–¥–∏–Ω–∞...</option>
                  <option value="08:00">08:00</option>
                  <option value="09:00">09:00</option>
                  <option value="10:00">10:00</option>
                  <option value="11:00">11:00</option>
                  <option value="12:00">12:00</option>
                  <option value="13:00">13:00</option>
                  <option value="14:00">14:00</option>
                  <option value="15:00">15:00</option>
                  <option value="16:00">16:00</option>
                  <option value="17:00">17:00</option>
                  <option value="18:00">18:00</option>
                  <option value="19:00">19:00</option>
                  <option value="20:00">20:00</option>
                  <option value="21:00">21:00</option>
                </select>
              </div>
            </div>

            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-success">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–ø–∏—Å</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="eventModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">–î–µ—Ç–∞–ª—ñ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p><strong>–ö–ª—ñ—î–Ω—Ç:</strong> <span id="modalClient"></span></p>
          <p><strong>–ü–æ—Å–ª—É–≥–∞:</strong> <span id="modalService"></span></p>
          <hr>
          <form id="editForm" action="/trainer/edit-booking" method="POST">
            <input type="hidden" name="booking_id" id="editId">
            <div class="row mb-3">
              <div class="col-6">
                <label class="form-label fw-bold">–ó–º—ñ–Ω–∏—Ç–∏ –¥–∞—Ç—É:</label>
                <input type="date" name="new_date" id="editDateOnly" class="form-control" required>
              </div>
              <div class="col-6">
                <label class="form-label fw-bold">–ó–º—ñ–Ω–∏—Ç–∏ —á–∞—Å:</label>
                <select name="new_time" id="editTimeSelect" class="form-select" required>
                  <option value="08:00">08:00</option>
                  <option value="09:00">09:00</option>
                  <option value="10:00">10:00</option>
                  <option value="11:00">11:00</option>
                  <option value="12:00">12:00</option>
                  <option value="13:00">13:00</option>
                  <option value="14:00">14:00</option>
                  <option value="15:00">15:00</option>
                  <option value="16:00">16:00</option>
                  <option value="17:00">17:00</option>
                  <option value="18:00">18:00</option>
                  <option value="19:00">19:00</option>
                  <option value="20:00">20:00</option>
                  <option value="21:00">21:00</option>
                </select>
              </div>
            </div>
          </form>
          <div class="d-flex justify-content-between mt-4 pt-2 border-top">
            <button type="submit" form="editForm" class="btn btn-success px-4">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
            <form action="/trainer/delete-booking" method="POST" class="m-0">
              <input type="hidden" name="booking_id" id="deleteId">
              <button type="submit" class="btn btn-danger px-4"
                onclick="return confirm('–í–∏ —Ç–æ—á–Ω–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∑–∞–ø–∏—Å?')">üóë –í–∏–¥–∞–ª–∏—Ç–∏</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
{{> footer}}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var calendarEl = document.getElementById('calendar');
      var myEvents = {{{ eventsJson }}};

    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'timeGridWeek',
      locale: 'uk',
      firstDay: 1,
      buttonText: { today: '–°—å–æ–≥–æ–¥–Ω—ñ', month: '–ú—ñ—Å—è—Ü—å', week: '–¢–∏–∂–¥–µ–Ω—å', day: '–î–µ–Ω—å', list: '–°–ø–∏—Å–æ–∫' },
      headerToolbar: { left: 'prev,next today', center: 'title', right: 'timeGridWeek,timeGridDay' },
      slotMinTime: '08:00:00',
      slotMaxTime: '22:00:00',
      allDaySlot: false,
      height: 'auto',
      events: myEvents,
      displayEventTime: false,

      eventClick: function (info) {
        var props = info.event.extendedProps;
        document.getElementById('modalClient').textContent = props.client;
        document.getElementById('modalService').textContent = props.service;
        document.getElementById('editId').value = info.event.id;
        document.getElementById('deleteId').value = info.event.id;
        document.getElementById('editDateOnly').value = props.dateOnly;
        document.getElementById('editTimeSelect').value = props.timeOnly;
        var myModal = new bootstrap.Modal(document.getElementById('eventModal'));
        myModal.show();
      }
    });
    calendar.render();
        });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>